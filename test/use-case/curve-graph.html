<!DOCTYPE html>
<html lang="zh-cn">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="shortcut icon" href="../../clay.png" type="image/x-png">
    <title>clay - 用例 - 曲线图</title>
    <script src="../../build/clay-1.4.0.js"></script>
    <script>
        function drawerLine(bx, by, ex, ey, color) {
            pencil.beginPath();
            pencil.moveTo(bx, by);
            pencil.lineTo(ex, ey);
            pencil.lineWidth = 1;
            pencil.strokeStyle = color;
            pencil.closePath();
            pencil.stroke();
        }
        function drawerPoint(color, rx, ry) {
            pencil.beginPath();
            pencil.strokeStyle = color;
            pencil.arc(rx, ry, 2, 0, Math.PI * 2);
            pencil.stroke();
            pencil.fill();
        }
        function toImageData(oralData) {
            var flag = 0, imageData = [];
            for (; flag < oralData.length; flag++) {
                imageData.push([
                    40 * flag + 80,
                    (250 - oralData[flag]) / 250 * 300 + 60
                ]);
            }
            return imageData;
        }
    </script>
</head>

<body></body>

<script>

    // 2015 和 2016降水量
    var data = {
        "2015": [2.6, 5.9, 9.0, 26.4, 28.7, 70.7, 175.6, 182.2, 48.7, 18.8, 6.0, 2.3],
        "2016": [3.9, 5.9, 11.1, 18.7, 48.3, 69.2, 231.6, 46.6, 55.4, 18.4, 10.3, 0.7]
    };

    // 初始化画布和获取画笔
    var pencil = $$('<canvas>非常抱歉，您的浏览器不支持canvas!</canvas>').appendTo('body')
        .attr('width', 600).attr('height', 420)
        .painter();

    // 绘制垂直刻度尺（包括水平横线）
    pencil.textAlign = 'right';
    $$.loop([
        // y坐标，颜色
        [60, '#538bf6'], [120, '#cccccc'], [180, '#cccccc'],
        [240, '#cccccc'], [300, '#cccccc'], [360, '#e42d58']
    ], function (item) {
        // 画线条
        drawerLine(60, item[0], 540, item[0], item[1]);
        // 画刻度
        drawerLine(60, item[0], 50, item[0], "#333333");
        // 添加刻度值
        pencil.fillText(250 - (item[0] - 60) / 300 * 250, 45, item[0]);
    });
    drawerLine(60, 60, 60, 360, "#333333");

    // 绘制二条水平刻度尺
    pencil.textAlign = 'center';
    $$.loop([
        [80, '2015-1', '2016-1'], [160, '2015-3', '2016-3'], [240, '2015-5', '2016-5'],
        [320, '2015-7', '2016-7'], [400, '2015-9', '2016-9'], [480, '2015-11', '2016-11']
    ], function (item) {
        // 画刻度
        drawerLine(item[0], 50, item[0], 60, "#538bf6")
        drawerLine(item[0], 360, item[0], 370, "#e42d58");
        // 添加刻度值
        pencil.fillStyle = "#538bf6";
        pencil.fillText(item[1], item[0], 40);
        pencil.fillStyle = "#e42d58";
        pencil.fillText(item[2], item[0], 385);
    });

    var
        // 获取二条曲线的插值函数
        line2015 = clay.cardinal().setP(toImageData(data['2015'])),
        line2016 = clay.cardinal().setP(toImageData(data['2016']));

    // 启动动画
    $$.animation(function (deep) {
        // 绘制曲线
        var flag;

        // 2015年
        pencil.beginPath();
        pencil.moveTo(80, line2015(80));
        for (flag = 80; flag <= deep * 440 + 80; flag += 0.1)
            pencil.lineTo(flag, line2015(flag));
        pencil.strokeStyle = "#538bf6";
        pencil.stroke();

        // 2016年
        pencil.beginPath();
        pencil.moveTo(80, line2016(80));
        for (flag = 80; flag <= deep * 440 + 80; flag += 0.1)
            pencil.lineTo(flag, line2016(flag));
        pencil.strokeStyle = "#e42d58";
        pencil.stroke();
    }, 700, function () {
        // 绘制点
        var flag;
        pencil.fillStyle = "#fff";
        pencil.lineWidth = 0.5;
        for (flag = 80; flag <= 520; flag += 40) {
            drawerPoint("#538bf6", flag, line2015(flag));
            drawerPoint("#e42d58", flag, line2016(flag));
        }
    });


</script>

</html>
